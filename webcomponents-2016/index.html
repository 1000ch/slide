<!doctype html>
<html>
  <head>
    <title>Web Components 2016 & Polymer v2</title>
    <link rel="stylesheet" href="../node_modules/talkiejs/dist/talkie.min.css">
    <link rel="stylesheet" href="../node_modules/talkiejs/dist/talkie-default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/monokai.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  </head>
  <body>
<template layout="title" type="text/x-markdown">

# Web Components 2016 & Polymer v2

2016.10.09 [DevFest Tokyo 2016](http://gdg-tokyo.connpass.com/event/38927/) [@1000ch](http://twitter.com/1000ch)

</template>

<template layout="bullets" type="text/x-markdown">

## @1000ch

- 株式会社サイバーエージェント
- Web 技術とか iOS とかいろいろ
- [https://1000ch.net](https://1000ch.net) の人

</template>

<template layout="bullets" type="text/x-markdown">

## アジェンダ

- Web Components おさらい
- 最近の Web Components 事情
- Polymer v2 リリース

</template>

<template layout="title" invert type="text/x-markdown">

# Web Components<br>おさらい

</template>

<template layout="cover" invert type="text/x-markdown" backface="./img/battle.jpg" backface-filter="brightness(.75)">

## 「Web モジュール」の難しさ

〜 Web 開発者が戦ってきたもの 〜

</template>

<template layout="bullets" type="text/x-markdown">

## 再利用可能な Web モジュール

- それを **作る難しさ** と **使うコスト**
- 特定のライブラリへの依存問題
- エコシステムが醸成されない問題
- 容赦なくグローバルを汚染する問題

</template>

<template layout="title" type="text/x-markdown">

## CSS だけはどうにもならない

<blockquote class="twitter-tweet" data-lang="ja"><p lang="und" dir="ltr">(╯°□°）╯︵ SSƆ</p>&mdash; 1000ch (@1000ch) <a href="https://twitter.com/1000ch/status/752394739438137344">2016年7月11日</a></blockquote>

CSS はつらい。本当につらい。

</template>

<template layout="bullets" type="text/x-markdown">

## Extensible Web の体現

- **Web 標準を組み合わせて実現する（重要）**
- 低レベル API は高レベル API を兼ねる
- 「Web モジュール」を作る手法が一般化される

</template>

<template layout="bullets" type="text/x-markdown">

## Web Components<br>を支える技術

- **Custom Elements**: 新たな要素の定義
- **Shadow DOM**: 隔離された DOM スコープ
- **HTML Imports**: 断片化した HTML のロード
- **Templates**: 不活性な HTML 要素

</template>

<template layout="title" invert type="text/x-markdown">

# 最近の Web Components 事情

</template>

<template layout="title" type="text/x-markdown">

## Shadow DOM v1<br>と<br>Custom Elements v1

これまでの仕様を v0 、新たなものを v1 として再策定が進んでいる

</template>

<template layout="bullets" type="text/x-markdown">

## Shadow DOM v1

- `createShadowRoot()` から `attachShadow()` へ
- readonly な `shadowRoot` プロパティ
- 複数 `Shadow Root` の廃止
- Opened な Shadow DOM と Closed な Shadow DOM
    - `/deep/` と `::shadow` の廃止
- [Shadow Root をホストできる要素が限定的に](https://dom.spec.whatwg.org/#dom-element-attachshadow)
- `<content>` から `<slot>` へ
    - `::content .foo` から `::slotted(.foo)` へ

</template>

<template layout="bullets" type="text/x-markdown">

## Custom Elements v1

- ES2015 class ベースの要素定義
- ライフサイクルコールバックの見直し
    - `constructor` (former: `createdCallback`)
    - `connectedCallback` (former: `attachedCallback`)
    - `disconnectedCallback` (former: `detachedCallback`)
    - `attributeChangedCallback`　(+ `observedAttributes`)
    - `adoptedCallback`: 要素が新たなドキュメントに移動した時
- `document.registerElement` から `window.customElements` へ
    - `customElements.get('foo-element')`
    - `customElements.whenDefined('foo-element').then(...)`

</template>

<template layout="code" type="text/x-markdown">

## Custom Elements v0

```html
<script>
  const FooElement = Object.create(HTMLElement.prototype);

  FooElement.createdCallback = () => { ... };
  FooElement.attachedCallback = () => { ... };
  FooElement.detachedCallback = () => { ... };
  FooElement.attributeChangedCallback = () => { ... };

  document.registerElement('foo-element', {
    prototype: FooElement
  });
</script>
```

</template>

<template layout="code" type="text/x-markdown">

## Custom Elements v1

```html
<script>
  class FooElement extends HTMLElement {
    constructor() { ... }
    connectedCallback() { ... }
    disconnectedCallback() { ... }
    attributeChangedCallback() { ... }
    adoptedCallback() { ... }
  }

  window.customElements.define('foo-element', FooElement);
</script>
```

</template>

<template layout="title" type="text/x-markdown">

## `is` 属性の行方…

WebKit は `<button is="foo-button" />` のような [Custom Elements によるネイティブ要素の拡張をしない方針](https://github.com/w3c/webcomponents/issues/509#issuecomment-233419167)を今のところ示している

</template>

<template layout="bullets" type="text/x-markdown">

## HTML Imports どうなった

- [Mozilla は ES6 Modules を意識して見送っている](https://hacks.mozilla.org/2014/12/mozilla-and-web-components/)
    - [JavaScript Loader](https://github.com/whatwg/loader) あたりの話
    - `<script type="module"></script>` のアセット解決方法
- [The state of Web Components](https://hacks.mozilla.org/2015/06/the-state-of-web-components/)

</template>

<template layout="bullets" invert backface="./img/webplatform.jpg" backface-filter="brightness(.25)" type="text/x-markdown">

## ブラウザサポート状況

- **Shadow DOM v0**: Chrome, Firefox w/flag, Safari 10, Opera
- **Shadow DOM v1**: Chrome 53~, Opera 40~, Safari 10
- **Custom Elements v0**: Chrome, Firefox w/flag, Opera
- **Custom Elements v1**: Chrome 54~, Opera 41~
- **HTML Imports**: Chrome, Firefox w/flag, Opera
- **Templates**: Chrome, Firefox, Safari, Opera, Edge

</template>

<template layout="title" type="text/x-markdown">

## Safari 10 に Shadow DOM v1 が実装された (❗)

</template>

<template layout="title" backface="./img/before.jpg" backface-filter="blur(1px) brightness(.8)"></template>

<template layout="title" type="text/x-markdown">

## Safari TP 14 に Shadow DOM v1 が実装された (❗❗)

_メニューの Develop → Experimental Features → Custom Elements_

</template>

<template layout="title" backface="./img/after.jpg" backface-filter="blur(1px) brightness(.8)"></template>

<template layout="bullets" type="text/x-markdown">

## Safari の実装が進むのは、開発者にとってかなり大きい

- モバイルでの利用がかなり現実的になってきた😍
- あとは Firefox と Edge を応援するだけ👆
- IE... (´・ω・`).;:...(´・ω...:.;::..(´・;::: .:.;: ...

</template>

<template layout="title" invert type="text/x-markdown">

# Polymer v2 🎉

</template>

<template layout="bullets" type="text/x-markdown">

## Polymer v2 のロードマップ

- Web Components "v1" の機能のフルサポート
- Polymer v1.x からのスムースなマイグレーション
- 標準にそぐわない "leaky" な抽象化を排除
- Polymer 内部のデータシステムの改善

</template>

<template layout="code" type="text/x-markdown">

## Polymer v2

```javascript
class MyElement extends Polymer.Element {
  static get is() { return 'my-element'; }
  static get config() {
    return {
      /* properties, observers meta data */
    };
  }
  constructor() { super(); }
  connectedCallback() { super.connectedCallback(); }
  ...
}
customElements.define(MyElement.is, MyElement);
```

</template>

<template layout="title" type="text/x-markdown">

## Polymer v1.x の<br>API も一応使える

`polymer.html` が引き続き提供され、`Polymer.dom()` や `Polymer.CompatElement` といった Polymer v1.x で提供されてきた API も含まれる。

</template>

<template layout="title" type="text/x-markdown">

## ネイティブ API への移行を強く推奨

Polymer で抽象化してきた API が排除されネイティブの API を使うように。例えば、[Shady DOM v1](https://github.com/webcomponents/shadydom)が提供されることで DOM 操作に関しても `Polymer.dom()` が不要になる。

</template>

<template layout="bullets" type="text/x-markdown">

## Polymer v1.x の機能は引き続き提供される

</template>

<template layout="code" type="text/x-markdown">

## Type Extension の雲行きが怪しいので…

```html
<template is="dom-repeat" items="{{items}}">
  ...
</template>

<style is="custom-style">
  ...
</style>
```

</template>

<template layout="code" type="text/x-markdown">

## Polymer でも非サポート `is="dom-repeat"` などは要修正

```html
<dom-repeat items="{{items}}">
  <template>...</template>
</dom-repeat>

<custom-style>
  <style>...</style>
</custom-style>
```

</template>

<template layout="cover" type="text/x-markdown"></template>
<template layout="title" type="text/x-markdown"></template>
<template layout="bullets" type="text/x-markdown"></template>
<template layout="code" type="text/x-markdown"></template>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../node_modules/talkiejs/dist/talkie.min.js"></script>
    <script>
      Talkie({
        wide         : false,
        control      : true,
        pointer      : true,
        progress     : true,
        backface     : true,
        notransition : true
      });
    </script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </body>
</html>
